<!DOCTYPE HTML> 
<html> 
 
<head> 
    <style> /* General styling */ 
        html { 
            height: 100%; 
            overflow: auto; 
        } 
 
        body { 
            height: 100%; 
        } 
 
        .hidden { 
            visibility: hidden; 
        } 
 
        /* Styling for the close button (the red x) */ 
        .closeBtn { 
            background: red; 
            display: block; 
            padding: 2% 3%; 
            float: right; 
            border-radius: 12px; 
            text-decoration: none; 
            color: white; 
            font-size: 4vh; 
            font-weight: bold; 
            border-top: 1px solid rgb(250, 150, 100); 
            -webkit-box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(100, 0, 0, .75) 0 0 40px inset; 
            -moz-box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(100, 0, 0, .75) 0 0 40px inset; 
            box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(100, 0, 0, .75) 0 0 40px inset; 
            text-shadow: 0 0 10px #000; 
            background: #f3c5bd; 
            background: -webkit-linear-gradient(top, #f3c5bd 0%, #e86c57 50%, #ea2803 51%, #ff6600 100%); 
            background: -moz-linear-gradient(top, #f3c5bd 0%, #e86c57 50%, #ea2803 51%, #ff6600 100%); 
            background: -o-linear-gradient(top, #f3c5bd 0%, #e86c57 50%, #ea2803 51%, #ff6600 100%); 
            background: linear-gradient(to bottom, #f3c5bd 0%, #e86c57 50%, #ea2803 51%, #ff6600 100%); 
            opacity: 1; 
        } 
 
        /* centres buttons within their div */ 
        .centredHolder { 
            display: flex; 
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center; 
            align-items: center;
        } 
 
        .bordered { 
            border: 2px dashed blue; 
        } 
 
        .optionContainer { 
            display: block; 
            position: relative; 
            padding-left: 4vw; 
            margin-bottom: 1vh; 
            cursor: pointer; 
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none; 
            user-select: none; 
        } 
 
        /* Hide the browser's default radio buttons and checkboxes */ 
        .optionContainer input { 
            position: absolute; 
            opacity: 0; 
            cursor: pointer; 
            height: 0; 
            width: 0; 
        } 
 
        /* show this radio button or checkbox instead */ 
        .radbtn, 
        .chkbox { 
            position: absolute; 
            top: 0; 
            left: 0; 
            height: 2.5vw; 
            width: 2.5vw; 
            background-color: #EEEEEE; 
            border-radius: 50%; 
        } 
 
        /* On mouse-over, add a grey background color */ 
        .optionContainer:hover input ~ .radbtn, 
        .optionContainer:hover input ~ .chkbox { 
            background-color: #CCCCCC; 
        } 
 
        /* When the button is selected, add a blue background */ 
        .optionContainer input:checked ~ .radbtn, 
        .optionContainer input:checked ~ .chkbox { 
            background-color: #2196F3; 
        } 
 
        /* Create the indicator (hidden when not checked) */ 
        .radbtn:after, 
        .chkbox:after { 
            content: ""; 
            position: absolute; 
            display: none; 
        } 
 
        /* Show the indicator when selected */ 
        .optionContainer input:checked ~ .radbtn:after, 
        .optionContainer input:checked ~ .chkbox:after { 
            display: block; 
        } 
 
        /* Style the indicator */ 
        .optionContainer .radbtn:after, 
        .optionContainer .chkbox:after { 
            left: 9px; 
            top: 3px; 
            width: 2px; 
            height: 10px; 
            border: solid white; 
            border-width: 0 2.5px 2.5px 0; 
            -webkit-transform: rotate(45deg); 
            -ms-transform: rotate(45deg); 
            transform: rotate(45deg); 
        } 
 
        /* Style to tooltip text */ 
        .tooltipContainer .tooltiptext { 
            position: absolute; 
            display: inline-block; 
            visibility: hidden; 
            opacity: 0; 
            background-color: black; 
            color: #fff; 
            font-size: 2vh; 
            text-align: center; 
            padding: 5px 0; 
            border-radius: 6px; 
            z-index: 100; 
        } 
 
        /* Show the tooltip text when you mouse over the tooltip container */ 
        .tooltipContainer:hover .tooltiptext { 
            position: relative; 
            visibility: visible; 
            opacity: 1; 
            transition: all 3s; 
        } 
 
        .fade-in { 
            animation: fadeIn ease 2s; 
            -webkit-animation: fadeIn ease 2s; 
            -moz-animation: fadeIn ease 2s; 
            -o-animation: fadeIn ease 2s; 
        } 
        
        .fade-in-fast { 
            animation: fadeIn ease 0.5s; 
            -webkit-animation: fadeIn ease 0.5s; 
            -moz-animation: fadeIn ease 0.5s; 
            -o-animation: fadeIn ease 0.5s; 
        } 

        @keyframes fadeIn { 
            0% { opacity: 0; }  
            100% { opacity: 1; } 
        } 

        @-moz-keyframes fadeIn { 
            0% { opacity: 0; }  
            100% { opacity: 1; } 
        } 

        @-webkit-keyframes fadeIn { 
            0% { opacity: 0; }  
            100% { opacity: 1; } 
        } 

        @-o-keyframes fadeIn { 
            0% { opacity: 0; }  
            100% { opacity: 1; } 
        } 

        @-ms-keyframes fadeIn { 
            0% { opacity: 0; }  
            100% { opacity: 1; } 
        } 

        .fade-out { 
            animation: fadeOut ease 2s; 
            -webkit-animation: fadeOut ease 2s; 
            -moz-animation: fadeOut ease 2s; 
            -o-animation: fadeOut ease 2s; 
        } 

        .fade-out-fast { 
            animation: fadeOut ease 0.5s; 
            -webkit-animation: fadeOut ease 0.5s; 
            -moz-animation: fadeOut ease 0.5s; 
            -o-animation: fadeOut ease 0.5s; 
        } 

        @keyframes fadeOut { 
            0% { opacity: 1; }  
            100% { opacity: 0; } 
        } 

        @-moz-keyframes fadeOut { 
            0% { opacity: 1; }  
            100% { opacity: 0; } 
        } 

        @-webkit-keyframes fadeOut { 
            0% { opacity: 1; }  
            100% { opacity: 0; } 
        } 

        @-o-keyframes fadeOut { 
            0% { opacity: 1; }  
            100% { opacity: 0; } 
        } 

        @-ms-keyframes fadeOut { 
            0% { opacity: 1; }  
            100% { opacity: 0; } 
        } 
    </style> 
    <style> /* Custom radio buttons and checkboxes */ 
        /* Style for the label */ 
        .choiceHolder { 
            display: block; 
            text-align: left; 
            position: relative; 
            padding-left: 4vmin; 
            margin: 1vmin; 
            cursor: pointer; 
            font-size: 3vmin; 
            -webkit-user-select: none; 
            -moz-user-select: none; 
            -ms-user-select: none; 
            user-select: none; 
        } 
 
        /* Hide the browser's default radio button */ 
        .choiceHolder input { 
            position: absolute; 
            opacity: 0; 
            cursor: pointer; 
            height: 0; 
            width: 0; 
        } 
 
        /* Create a custom radio button */ 
        .indicator { 
            position: absolute; 
            left: 0; 
            height: 3vmin; 
            width: 3vmin; 
            background-color: #EEEEEE; 
            border-radius: 50%; 
        } 
 
        /* On mouse-over, add a grey background color */ 
        .choiceHolder:hover input~.indicator { 
            background-color: #CCCCCC; 
        } 
 
        /* When the radio button is checked, add a blue background */ 
        .choiceHolder input:checked~.indicator { 
            background-color: #2196F3; 
        } 
 
        /* Create the indicator (the dot/circle - hidden when not checked) */ 
        .indicator:after { 
            content: ""; 
            position: absolute; 
            display: none; 
        } 
 
        /* Show the indicator (dot/circle) when checked */ 
        .choiceHolder input:checked~.indicator:after { 
            display: block; 
        } 
 
        /* Style the indicator (dot/circle) */ 
        .choiceHolder .indicator:after { 
            top: 0.75vmin; 
            left: 0.75vmin; 
            width: 1.5vmin; 
            height: 1.5vmin; 
            border-radius: 50%; 
            background: white; 
        } 
    </style> 
    <style> /* Background display */ 
        .BackgroundContainer { 
            height: 100%; 
            z-index: 0; 
        } 
 
        .fixed { 
            background-attachment: fixed; 
            background-repeat: repeat-y; 
            background-position: center center; 
            height: 100%; 
            width: 100%; 
            color: #eeeeee; 
            text-align: center; 
            display: table; 
        } 
    </style> 
    <style> /* Sequence display area */ 
        #SequenceArea { 
            position: absolute; 
            top: 50vh; 
            width: 100%; 
            z-index: 10; 
            display: flex; 
            justify-content: center; 
        } 
 
        #SequenceArea img { 
            position: absolute; 
            width: 50%; 
        } 
 
        #gameOutline { 
            position: relative; 
            z-index: 20; 
        } 
    </style> 
    <style> /* Style the SideTabs to be sliding buttons */      
        #SideTabLeft a, 
        #SideTabRight a,
        #SideTabBottom a { 
            position: fixed; 
            z-index: 40; 
            /* Remove underline */ 
            text-decoration: none; 
            /* Centres text horizontally in the anchor element */ 
            text-align: center; 
            line-height: 3vh; 
        } 
 
        #SideTabLeft a span, 
        #SideTabRight a span,
        #SideTabBottom a span { 
            /* Hide tab text in case it spills over into view */ 
            opacity: 0; 
        } 
 
        #SideTabLeft a:hover span, 
        #SideTabLeft a.simhover span,
        #SideTabRight a:hover span, 
        #SideTabRight a.simhover span,
        #SideTabBottom a:hover span, 
        #SideTabBottom a.simhover span { 
            /* Show tab text on hover */ 
            opacity: 1; 
            transition: 0.3s; 
        } 
 
        #SideTabLeft a { 
            font-size: 3vh; 
            padding: 2vh; 
            /* Rounded corners on the top right and bottom right side */ 
            border-radius: 0 5px 5px 0; 
            /* Position them relative to the viewport - not affected by scrolling */ 
            width: 15vw; 
            /* Position them outside of the screen */ 
            left: -15vw; 
            /* Add transition on hover */ 
            transition: 0.3s; 
        } 
 
        #SideTabLeft a:hover, 
        #SideTabLeft a.simhover { 
            /* On mouse-over, make the elements appear as they should */ 
            left: 0; 
            color: white; 
            opacity: 1; 
            /* Add transition on hover */ 
            transition: 0.3s; 
        } 
 
        #SideTabRight a { 
            font-size: 3vh; 
            padding: 2vh; 
            /* Rounded corners on the top left and bottom left side */ 
            border-radius: 5px 0 0 5px; 
            /* Position them relative to the viewport - not affected by scrolling */ 
            width: 15vw; 
            /* Position them outside of the screen */ 
            right: -15vw; 
            /* Add transition on hover */ 
            transition: 0.3s; 
        } 
 
        /* On mouse-over, make the elements appear as they should */ 
        #SideTabRight a:hover, 
        #SideTabRight a.simhover { 
            right: 0; 
            color: white; 
            opacity: 1; 
            /* Add transition on hover */ 
            transition: 0.3s; 
        } 

        #SideTabBottom a { 
            font-size: 2vw; 
            padding: 2vh; 
            /* Rounded corners on the top left and top right side */ 
            border-radius: 5px 5px 0 0; 
            /* Position them outside of the screen */ 
            bottom: -5vh; 
            /* Add transition on hover */ 
            transition: 0.3s; 
        } 
 
        /* On mouse-over, make the elements appear as they should */ 
        #SideTabBottom a:hover, 
        #SideTabBottom a.simhover { 
            bottom: 0; 
            color: white; 
            opacity: 1; 
            /* Add transition on hover */ 
            transition: 0.3s; 
        } 
 
        /* The newgame_setup() link */ 
        #newGame { 
            top: 5vh; 
            background-color: #04AA6D; 
            color: #04AA6D; 
        } 
 
        /* The game_backToPreviousStep() link */ 
        #back { 
            top: 16vh; 
            background-color: #2196F3; 
            color: #2196F3; 
        } 
 
        #skip { 
            top: 27vh; 
            background-color: #f44336; 
            color: #f44336; 
        } 
 
        #elim { 
            top: 49vh; 
            background-color: #050505; 
            color: #050505; 
        } 
 
        #oosEAttack { 
            top: 5vh; 
            background-color: #FF5733; 
            color: #FF5733; 
        } 
 
        #oosPAttack { 
            top: 27vh; 
            background-color: #964a18; 
            color: #964a18; 
        } 
 
        #options { 
            top: 49vh; 
            background-color: #199fA9; 
            color: #199fA9; 
        } 
 
        #about { 
            top: 60vh; 
            background-color: #FFC300; 
            color: #FFC300; 
        } 
        
        #loadSave { 
            right: 8%; 
            background-color: #ff00f2; 
            color: #ff00f2; 
        } 
    </style> 
    <style> /* Modal Dialogue */ 
        /* (adapted from https://cssdeck.com/labs/css3-sleek-black-modal) */ 
        .modal { 
            /* Hidden by default */ 
            display: none; 
            /* Stay in place */ 
            position: fixed; 
            left: 20vw; 
            top: 2vw; 
            width: 60vw; 
            z-index: 30; 
            background-color: #fff; 
            margin: 0 auto; 
            padding: 5px; 
            text-align: center; 
            border-radius: 12px; 
            color: white; 
            -webkit-box-shadow: rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(0, 0, 0, .75) 0 0 70px inset; 
            -moz-box-shadow: rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(0, 0, 0, .75) 0 0 70px inset; 
            box-shadow: rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(0, 0, 0, .75) 0 0 70px inset; 
            background: rgba(125, 126, 125, 0.85); 
            background: -moz-linear-gradient(top, rgba(125, 126, 125, 0.85), rgba(14, 14, 14, 0.85)); 
            background: -webkit-linear-gradient(top, rgba(125, 126, 125, 0.85), rgba(14, 14, 14, 0.85)); 
            background: -o-linear-gradient(top, rgba(125, 126, 125, 0.85), rgba(14, 14, 14, 0.85)); 
            background: linear-gradient(to bottom, rgba(125, 126, 125, 0.85), rgba(14, 14, 14, 0.85)); 
            border-top: 1px solid #666; 
            overflow: hidden; 
        } 
 
        #modal h1 { 
            text-align: left; 
            margin: 0; 
            font-size: 6vh; 
            letter-spacing: -1px; 
            margin-bottom: 1vh; 
            text-shadow: 0 -1px 1px #000, 0 0px 3px rgba(0, 0, 0, .25); 
        } 
 
        .modal-content p { 
            margin-top: 5vh 0 7vh; 
            color: #FFD700; 
            font-size: 5vh; 
            text-align: center; 
            text-shadow: 0 0px 5px rgba(0, 0, 0, .25), 0 -1px 1px #000; 
        } 
 
        .modalBtn { 
            background: green; 
            display: block; 
            padding: 5% 5%; 
            border-radius: 12px; 
            float: left; 
            text-decoration: none; 
            color: white; 
            margin: 5px 5px 5px 5px; 
            font-weight: bold; 
            text-shadow: 0 0 10px #000; 
            border-top: 1px solid rgb(200, 250, 100); 
            font-size: 4vmin; 
            -webkit-box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(0, 50, 0, .75) 0 0 40px inset; 
            -moz-box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(0, 50, 0, .75) 0 0 40px inset; 
            box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 10px, rgba(0, 50, 0, .75) 0 0 40px inset; 
            background: -webkit-linear-gradient(top, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
            background: -moz-linear-gradient(top, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
            background: -o-linear-gradient(top, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
            background: linear-gradient(to bottom, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
        } 
 
        .modalBtn.small { 
            font-size: 2vw; 
        } 
 
        #NamesArea .nameInp { 
            flex-basis: 55%;
            text-align: center; 
            width: 16;
            background-color: rgb(180, 181, 91);
            border-radius: 6px; 
            margin: 1%;
            padding: 1vmax;  
            z-index: 50; 
            width: fit-content; 
        }

        #NamesArea .tooltipContainer {   
            flex-basis: 50%;
        }

        #NamesArea .nameSwap { 
            color:rgb(200, 250, 100);
            background-color: #909497;
            border-radius: 3px; 
        }
    </style> 
    <style> /* Help */ 
        .help { 
            position: fixed; 
            z-index: 50; 
            left: 5vw; 
            width: 90vw; 
            top: 2vh; 
            bottom: 2vh; 
            background: #909497; 
        } 
 
        #helpAreaHeader { 
            margin-top: 7vh 0 10vh; 
            color: #FFD700; 
            font-size: 5vh; 
            text-align: center; 
            text-shadow: 0 0px 5px rgba(0, 0, 0, .25), 0 -1px 1px #000; 
        } 
 
        .help iframe { 
            width: 85vw; 
            height: 65vh; 
        } 
 
        .help iframe body { 
            transform: scale(3); 
        } 
 
        .helpBtn { 
            background: DarkTurquoise; 
            display: block; 
            padding: 2% 2%; 
            border-radius: 12px; 
            float: left; 
            text-decoration: none; 
            color: white; 
            margin: 1px 1px 1px 1px; 
            font-weight: bold; 
            text-shadow: 0 0 10px #000; 
            border-top: 1px solid rgb(200, 250, 100); 
            font-size: 2vh; 
            -webkit-box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 5px, rgba(0, 50, 0, .75) 0 0 20px inset; 
            -moz-box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 5px, rgba(0, 50, 0, .75) 0 0 20px inset; 
            box-shadow: rgba(255, 255, 255, .3) 0 2px 1px, rgba(0, 0, 0, .3) 0 -2px 1px, rgba(0, 0, 0, 0.5) 0px 3px 5px, rgba(0, 50, 0, .75) 0 0 2 inset; 
            background: #bfd255; 
            background: -webkit-linear-gradient(top, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
            background: -moz-linear-gradient(top, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
            background: -o-linear-gradient(top, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
            background: linear-gradient(to bottom, #bfd255 0%, #8eb92a 50%, #72aa00 51%, #9ecb2d 100%); 
        } 
    </style> 
    <style> /* Miscellaneous */ 
        #InfoArea { 
            position: fixed; 
            bottom: 0px; 
            float: left; 
            font-size: 1vw; 
            background-color: #909497;
            z-index: 50; 
        } 
 
        #AboutArea { 
            position: absolute; 
            padding: 2vh 2vw; 
            top: 15vh; 
            left: 10vw; 
            width: 80vw; 
            text-align: center; 
            font-size: 2vw; 
            padding: 2vmax; 
            color: white; 
            background-color: SlateGray; 
            z-index: 50; 
        } 
 
        .about iframe { 
            width: 80vw; 
            height: 65vh; 
            background-color: #CCCCCC;
        } 
 
        .about iframe body { 
            transform: scale(3); 
        } 
 
        #OptionsArea { 
            position: absolute; 
            top: 15vh; 
            left: 10vw; 
            width: 80vw; 
            text-align: center; 
            font-size: 3vw; 
            padding: 2vmax; 
            color: white; 
            background-color: rgb(181, 91, 91); 
            z-index: 50; 
        } 
 
        .optionSet { 
            border: 2px solid white; 
            margin: 1vmin; 
            padding: 2vh; 
        } 
 
        #LoadSaveArea { 
            position: absolute; 
            top: 15vh; 
            left: 10vw; 
            width: 80vw; 
            text-align: center; 
            font-size: 3vw; 
            padding: 2vmax; 
            color: white; 
            background-color: rgb(180, 181, 91); 
            z-index: 50; 
        } 

        #codeErr {
            color:rgba(100, 0, 0, .75);
        } 
    </style> 
</head> 
 
<body> 
    <div data-title='TrackerDisplay'> 
        <div class="BackgroundContainer"></div> 
        <div id="SequenceArea"> 
            <div id='gameOutline' class='bordered'></div> 
        </div> 
        <div id='SideTabLeft'> 
            <div class='hidden'><a href='#' id='newGame'></a></div> 
            <div class='hidden'><a href='#' id='back'></a></div> 
            <div class='hidden'><a href='#' id='skip'></a></div> 
            <div class='hidden'><a href='#' id='elim'></a></div> 
        </div> 
        <div id='SideTabRight'> 
            <div class='hidden'><a href='#' id='oosEAttack'></a></div> 
            <div class='hidden'><a href='#' id='oosPAttack'></a></div> 
            <div class='hidden'><a href='#' id='options'></a></div> 
            <div class='hidden'><a href='#' id='about'></a></div> 
        </div>
        <div id='SideTabBottom'>
            <div class='hidden'><a href='#' id='loadSave'></a></div>
        </div> 
        <div id='GameModal' class='modal'> 
            <div class='modal-content'> 
                <div class='modalBanner'>banner: round information goes here</div> 
                <div class='modalChangeBanner'>banner: phase change information goes here</div> 
                <span id='modalClose' class='closeBtn tooltipContainer'>&times;</span> 
                <h1>header: phase information goes here</h1> 
                <p>detail: step information goes here</p> 
                <div id='NamesArea' class='centredHolder'></div>
                <div class='modalButtonsArea centredHolder'></div> 
            </div> 
            <div id='HelpArea' class='help'> 
                <div id='helpAreaHeader'> 
                    <span class='closeBtn tooltipContainer' onclick='game_hideHelp()'>&times;</span> 
                    <p>step name goes here</p> 
                </div> 
                <div id='helpAreaDisplay'></div> 
            </div> 
        </div> 
        <div id='InfoArea' onclick='gui_clearAndReload()'></div> 
        <div id='AboutArea' class='about'> 
            <iframe src='readme.html' type='text/html'></iframe>
        </div> 
        <div id='OptionsArea'> 
            <form name='options'> 
                <div class='optionSet'>Display the Compendium Rules as 
                    <label class='choiceHolder'>HTML 
                        <input type='radio' name='compendiumAs'> 
                        <span class='indicator'></span> 
                    </label> 
                    <label class='choiceHolder'>PDF 
                        <input type='radio' name='compendiumAs'> 
                        <span class='indicator'></span> 
                    </label> 
                </div> 
                <div class='optionSet'>Show tooltips 
                    <label class='choiceHolder'>Show general tooltips 
                        <input type='checkbox' name='showGenTips'> 
                        <span class='indicator'></span> 
                    </label> 
                    <label class='choiceHolder'>Show tooltips on tabs 
                        <input type='checkbox' name='showTabTips'> 
                        <span class='indicator'></span> 
                    </label> 
                </div> 
                <div class='optionSet'>Sequence Options 
                    <label class='choiceHolder'>Alternate Setup (reduces shuffling decks) 
                        <input type='checkbox' name='altSetup'> 
                        <span class='indicator'></span> 
                    </label> 
                    <label class='choiceHolder'>Show End/Start of phases as steps 
                        <input type='checkbox' name='showChangePhaseSteps'> 
                        <span class='indicator'></span> 
                    </label> 
                </div> 
            </form> 
        </div> 
        <div id='LoadSaveArea'>
            <form name='loadsave'>
                To save the current game information, copy the information below and use your text editor of choice to save the code.
                <textarea id='codeBox' rows='5' cols='50'></textarea>
                <br>To load information about a previously saved game, paste the saved code in the space above and then click outside this area.<br>
                <span id="codeErr"></span>
            </form>
        </div>
    </div> 
    <script> /*Set up */ 
        var VERSION = 'v2.0.2'; 
 
        /* define game steps */ 
        var Sequence = JSON.parse( 
            // boxes format (in px): [left, top, right, bottom] or [initialplayerbox, subsequentplayerbox, finalplayerbox] 
            // help format: [compendium_info, companion_info, action_window_info] 
            //              compendium_info:    [page number, pdf horiz offset, pdf offset, html jump index, html highlight index] 
            //              companion_info:     [page number] 
            //   (optional) action_window_info: [page number, pdf horiz offset, pdf offset, html jump index, html highlight index] 
            // gameloop: value indicates the last step in the loop. After that step, the tracker will increment the round and loop back to this step. 
            // playerloop: value indicates the last step in each player's steps. After that step, the tracker will return to this step for the same player. Should be combined with a playerskip. 
            // playerskip: value indicates prompt. If the player opts to skip, then the tracker will switch to the next player and loop back to this step, or, if the player was the last player, continue to the next step. 
            // teamloop: value indicates the last step in each player's steps. After that step, the tracker will switch to the next player and loop back to this step, or, if the player was the last player, continue to the next step. 
            // teamskip: value indicates prompt and next step for all players if the first player opts to skip. 
            '{ "origSetup": [ { "phase": "Setup", "name": "Extract Campaign Setup Cards", "type": "campaign" } ' + 
            '                ,{ "phase": "Setup", "name": "Shuffle Player Deck{|s}", "help": [[47,0,135,1,1],[209]] } ' + 
            '                ,{ "phase": "Setup", "name": "Shuffle Encounter Deck", "help": [[47,0,130,1,2],[209]] } ' + 
            '                ,{ "phase": "Setup", "name": "Place Heroes", "help": [[47,0,400,2,3],[210]] } ' + 
            '                ,{ "phase": "Setup", "name": "Perform Campaign Setup", "help": [[47,0,700,3,4],[210]], "type": "campaign" } ' + 
            '                ,{ "phase": "Setup", "name": "Set Threat Level{|s}", "help": [[47,0,400,2,5],[210]] } ' + 
            '                ,{ "phase": "Setup", "name": "Create Token Bank{|s}", "help": [[47,500,305,4,6],[211]] } ' + 
            '                ,{ "phase": "Setup", "name": "Determine First Player", "help": [[47,500,380,5,7],[212]], "type": "1st multi" } ' + 
            '                ,{ "phase": "Setup", "name": "Draw Starting Hand{|s}", "help": [[47,500,455,6,8],[213]] } ' + 
            '                ,{ "phase": "Setup", "name": "Place Quest Cards", "help": [[47,500,555,7,9],[214]] } ' + 
            '                ,{ "phase": "Setup", "name": "Perform Scenario Setup", "help": [[47,500,650,8,10],[215]] } ' + 
            '               ] ' + 
            ' ,"altSetup": [ { "phase": "Setup", "name": "Place Heroes and Player Deck{|s}", "help": [[47,0,400,2,3],[210]] } ' + 
            '               ,{ "phase": "Setup", "name": "Place Quest Cards", "help": [[47,500,555,7,9],[214]] } ' + 
            '               ,{ "phase": "Setup", "name": "Place Campaign Setup Card", "type": "campaign" } ' + 
            '               ,{ "phase": "Setup", "name": "Create the Encounter Deck" } ' + 
            '               ,{ "phase": "Setup", "name": "Set up Boons and Burdens from the Campaign Pool", "type": "campaign", "help": [[47,0,700,3,4],[210]] } ' + 
            '               ,{ "phase": "Setup", "name": "Set Threat Level{|s}", "help": [[47,0,400,2,5],[210]] } ' + 
            '               ,{ "phase": "Setup", "name": "Create Token Bank{|s}", "help": [[47,500,305,4,6],[211]] } ' + 
            '               ,{ "phase": "Setup", "name": "Determine First Player", "help": [[47,500,380,5,7],[212]], "type": "1st multi" } ' + 
            '               ,{ "phase": "Setup", "name": "Perform Campaign Setup", "help": [[47,0,700,3,4],[210]], "type": "campaign" } ' + 
            '               ,{ "phase": "Setup", "name": "Perform Scenario Setup", "help": [[47,500,650,8,10],[215]] } ' + 
            '               ,{ "phase": "Setup", "name": "Shuffle Player Deck{|s}", "help": [[47,0,135,1,1],[209]] } ' + 
            '               ,{ "phase": "Setup", "name": "Shuffle Encounter Deck", "help": [[47,0,130,1,2],[209]] } ' + 
            '               ,{ "phase": "Setup", "name": "Draw Starting Hand{|s}", "help": [[47,500,455,6,8],[213]] } ' + 
            '              ] '  + 
		    ' ,"mainSeq": [ { "phase": "Change",    "name": "Start of the Resource Phase", "gameloop": "End of the Refresh Phase", "boxes": [60,75,490,135] } ' + 
            '              ,{ "phase": "Resource",  "name": "Gain Resources", "boxes": [60,135,490,190], "help": [[48,0,510,1,1],[217]] }' + 
            '              ,{ "phase": "Resource",  "name": "Draw Card{|s}", "actionwindow": true, "boxes": [60,190,490,310], "help": [[48,0,620,1,2],[217],[128,0,400,1,1]] } ' + 
		    '              ,{ "phase": "Change",    "name": "End of the Resource Phase<br/>Start of the Planning Phase", "boxes": [60,315,490,527] } ' + 
            '              ,{ "phase": "Planning",  "name": "{pp}Special Action Window", "teamloop": "{pp}Special Action Window", "boxes": [[60,470,490,685],[60,525,490,685],[60,525,490,740]], "help": [[48,0,710,2,3],[218],[128,0,600,2,2]] } ' + 
		    '              ,{ "phase": "Change",    "name": "End of the Planning Phase<br/>Start of the Quest Phase", "boxes": [60,688,490,900] } ' + 
            '              ,{ "phase": "Quest",     "name": "Quest Action Window", "boxes": [60,840,490,960], "help": [[],[],[128,0,920,3,3]] } ' + 
            '              ,{ "phase": "Quest",     "name": "Commit Characters", "actionwindow": true, "boxes": [60,960,490,1080], "help": [[48,500,100,3,4],[220],[129,0,50,1,1]] } ' + 
            '              ,{ "phase": "Quest",     "name": "{pp}Staging", "teamloop": "{pp}Staging", "boxes": [60,1080,490,1135], "help": [[48,500,380,4,5],[221]] } ' + 
            '              ,{ "phase": "Quest",     "name": "Staging Action Window", "boxes": [60,1135,490,1195], "help": [[],[],[129,0,280,2,2]] } ' + 
            '              ,{ "phase": "Quest",     "name": "Quest Resolution", "actionwindow": true, "boxes": [60,1195,490,1315], "help": [[48,500,825,5,6],[222],[129,0,420,3,3]] } ' + 
		    '              ,{ "phase": "Change",    "name": "End of the Quest Phase<br/>Start of the Travel Phase", "boxes": [60,1318,490,1530] } ' + 
            '              ,{ "phase": "Travel",    "name": "Travel Opportunity", "actionwindow": true, "boxes": [60,1530,490,1645], "help": [[49,500,100,1,1],[227],[129,0,725,4,4]] } ' + 
		    '              ,{ "phase": "Change",    "name": "End of the Travel Phase<br/>Start of the Encounter Phase", "boxes": [60,1650,490,1865] } ' + 
		    '              ,{ "phase": "Encounter", "name": "Optional Engagement", "actionwindow": true, "boxes": [60,1860,490,1980], "help": [[49,500,750,2,2],[232],[129,0,910,5,5]] } ' + 
            '              ,{ "phase": "Encounter", "name": "Engagement Checks", "actionwindow": true, "boxes": [60,1980,490,2100], "help": [[50,0,50,1,1],[233],[129,0,980,6,6]] } ' + 
		    '              ,{ "phase": "Change",    "name": "End of the Encounter Phase<br/>Start of the Combat Phase", "teamskip": ["No Combat?~Select if there are no Enemy or Player Attacks this Round", "Ready All Cards"], "boxes": [60,2105,490,2310] } ' + 
            '              ,{ "phase": "Combat",    "name": "{pp}Deal Shadow Cards", "actionwindow": true, "teamskip": ["No Combat?~Select if there are no Enemy or Player Attacks this Round", "Ready All Cards"], "teamloop": "{pp}Deal Shadow Cards", "boxes": [60,2320,490,2428], "help": [[50,0,845,2,2],[237],[130,0,130,1,1]] } ' + 
            '              ,{ "phase": "Combat",    "stage": "Enemy Attacks",  "name": "{pp}Choose Attacking Enemy", "actionwindow": true, "playerskip": "{pn} is not being attacked by an{=other} Enemy?~Select if all Enemy attacks against {pn} have been resolved", "playerloop": "{pp}Determine Combat Damage to Defender", "boxes": [[60,2428,490,2675],[60,2480,490,2675]], "help": [[50,500,150,3,3],[238],[130,0,270,2,2]] } ' + 
            '              ,{ "phase": "Combat",    "stage": "Enemy Attacks",  "name": "{pp}Declare Defender", "actionwindow": true, "boxes": [60,2675,490,2795], "help": [[50,500,190,4,4],[238],[130,0,410,3,3]] } ' + 
            '              ,{ "phase": "Combat",    "stage": "Enemy Attacks",  "name": "{pp}Reveal and Resolve Shadow Effect", "actionwindow": true, "boxes": [60,2795,490,2915], "help": [[50,500,300,5,5],[238],[130,0,535,4,4]] } ' + 
            '              ,{ "phase": "Combat",    "stage": "Enemy Attacks",  "name": "{pp}Determine Combat Damage to Defender", "actionwindow": true, "boxes": [60,2915,490,3035], "help": [[50,0,340,6,6],[238],[130,0,730,5,5]] } ' + 
            '              ,{ "phase": "Combat",    "stage": "Player Attacks", "name": "{pp}Choose Enemy to Attack and Attackers", "actionwindow": true, "playerskip": "{pn} is not attacking an{=other} Enemy?~Select if all Attacks by {pn} have been resolved.", "playerloop": "{pp}Determine Combat Damage to Enemy", "boxes": [0,3330,470,3585], "help": [[51,0,290,1,1],[240],[131,0,85,1,1]] } ' + 
            '              ,{ "phase": "Combat",    "stage": "Player Attacks", "name": "{pp}Determine Attacker Strength", "actionwindow": true , "boxes": [0,3585,470,3705], "help": [[51,0,345,2,2],[240],[131,0,160,2,2]] } ' + 
            '              ,{ "phase": "Combat",    "stage": "Player Attacks", "name": "{pp}Determine Combat Damage to Enemy", "actionwindow": true, "boxes": [0,3705,470,3825], "help": [[51,0,390,3,3],[240],[131,0,350,3,3]] } ' + 
            '              ,{ "phase": "Combat",    "name": "Discard All Shadow Cards", "boxes": [0,4060,470,4110], "help": [[51,0,860,4,4]] } ' + 
		    '              ,{ "phase": "Change",    "name": "End of the Combat Phase<br/>Start of the Refresh Phase", "boxes": [60,4065,490,4267] } ' + 
            '              ,{ "phase": "Refresh",   "name": "Ready All Cards", "boxes": [0,4265,470,4320], "help": [[52,500,315,1,1],[255]] } ' + 
            '              ,{ "phase": "Refresh",   "name": "Raise Threat Level{|s}", "boxes": [0,4325,470,4380], "help": [[52,500,315,1,1],[255]] } ' + 
            '              ,{ "phase": "Refresh",   "name": "{End of Round Action Window|Pass First Player Token to {pn+}}", "actionwindow": true, "boxes": [0,4380,470,4500], "help": [[52,500,315,1,1],[255],[131,0,420,4,4]] } ' + 
		    '              ,{ "phase": "Change",    "name": "End of the Refresh Phase<br/>Start of the next Round", "boxes": [60,4500,490,4560] } ' + 
            '             ] ' + 
            ' ,"oosEAttack": [ { "phase": "Special", "stage": "Out of Sequence Combat", "name": "Deal Shadow Card", "actionwindow": true, "boxes": [60,2320,490,2428], "help": [[50,0,845,2,2],[237],[130,0,130,1,1]] } ' + 
            '                 ,{ "phase": "Special", "stage": "Out of Sequence Combat", "name": "Declare Defender", "actionwindow": true, "boxes": [60,2675,490,2795], "help": [[50,500,190,4,4],[238],[130,0,410,3,3]] } ' + 
            '                 ,{ "phase": "Special", "stage": "Out of Sequence Combat", "name": "Reveal and Resolve Shadow Effects", "actionwindow": true, "boxes": [60,2795,490,2915], "help": [[50,500,300,5,5],[238],[130,0,535,4,4]] } ' + 
            '                 ,{ "phase": "Special", "stage": "Out of Sequence Combat", "name": "Apply Combat Damage to Defender", "oosReturn": 4, "actionwindow": true, "boxes": [60,2915,490,3035], "help": [[50,0,340,6,6],[238],[130,0,730,5,5]] } ' + 
            '                ] ' + 
            ' ,"oosPAttack": [ { "phase": "Special", "stage": "Out of Sequence Combat", "name": "Declare Attacked Enemy and Attackers", "actionwindow": true, "help": [[51,0,290,1,1],[240],[131,0,85,1,1]] } ' + 
            '                 ,{ "phase": "Special", "stage": "Out of Sequence Combat", "name": "Determine Attacker Strength", "actionwindow": true , "boxes": [0,3585,470,3705], "help": [[51,0,345,2,2],[240],[131,0,160,2,2]] } ' + 
            '                 ,{ "phase": "Special", "stage": "Out of Sequence Combat", "name": "Apply Combat Damage to Enemy", "oosReturn": 3, "actionwindow": true, "boxes": [0,3705,470,3825], "help": [[51,0,390,3,3],[240],[131,0,350,3,3]] } ' + 
            '                ] ' + 
            ' ,"areas": [ { "name": "RESOURCE" ' + 
            '              ,"voffset": 0 ' + 
            '              ,"images": [ "e4/a5/e4a52d3a-5484-492f-a628-6948e65fe26f/jme07_preview1.jpg" ' + 
            '                          ,"0c/29/0c29b8cc-3f7a-4a90-a063-64576995a29d/mec32_one-ring_preview.jpg" ' + 
            '                          ,"8f/66/8f66dc61-addd-4d8a-9a07-42f070536499/mec08_preview.jpg" ' + 
            '                          ,"28/53/28531b9e-a3f6-4c50-a1ec-39899ac073cb/mec17_preview.jpg" ' + 
            '                          ,"b6/7b/b67b151e-6fc1-4ce6-be68-161ce41db527/mec41_scavengeforsupplies.jpg" ' + 
            '                          ,"5c/72/5c726df9-6d05-4495-bc87-1444d31d820d/lanwyn-art.jpg" ' + 
            '                          ,"e9/8e/e98e9306-93cb-4921-b406-bc33baed9f8d/mec32_art_frodo.png" ' + 
            '                          ,"1a/1a/1a1a31e5-7ed7-45c4-81e3-5b51f2a39312/mec48-hold-the-line-art.jpg" ' + 
            '                          ,"6b/19/6b194864-c66c-4fdb-9ef0-503bd3126076/mec57_preview1.png" ' + 
            '                          ,"34/eb/34eb9df7-379c-4a13-bd89-d5aad6681621/mec67_preview2.png" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "PLANNING" ' + 
            '              ,"voffset": 390 ' + 
            '              ,"images": [ "c8/7e/c87eb0e6-2b62-442b-b151-157b73c9d310/ffi-preview.jpg" ' + 
            '                          ,"bc/28/bc28f1d8-cfab-489b-bbe4-b0704715f471/mec34_preview.jpg" ' + 
            '                          ,"b7/1f/b71f7ce7-d492-46ec-878f-6d245f99e077/mec56-preview2.jpg" ' + 
            '                          ,"22/27/2227a0cf-4626-41a0-939c-542a115b3261/mec102-preview.jpg" ' + 
            '                          ,"4b/04/4b04d488-568b-471e-8206-8b1dd89c94f5/expert-trackers-art.jpg" ' + 
            '                          ,"77/f6/77f6897e-b5df-42fd-afed-76a33c1b4d21/mountainsofangmar.jpg" ' + 
            '                          ,"27/09/270975dd-cf2c-4498-a29e-0439555668ee/mec56_art_explore-secret-ways.png" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "QUEST" ' + 
            '              ,"voffset": 762 ' + 
            '              ,"images": [ "e4/2f/e42f7766-9576-40f9-a04b-913bcad74fb6/jme01_preview_7.jpg" ' + 
            '                          ,"bd/7c/bd7cf918-9c0f-4010-aff9-417431615ce7/mec01_step_00.jpg" ' + 
            '                          ,"5e/02/5e02b79e-cb55-46df-92da-ec1e0c35f4e4/mec62_heavy-and-tired_art.jpg" ' + 
            '                          ,"89/cb/89cb9619-d7c4-418b-9714-5aa7d839c1c8/mec41_barrenmoorland.jpg" ' + 
            '                          ,"b4/a1/b4a16672-8928-41e5-9813-938c617c9962/mec42-art4.jpg" ' + 
            '                          ,"86/5f/865f7363-6cac-42b9-a721-dffc64391bde/mec32_art_take-no-notice.png" ' + 
            '                          ,"79/65/7965eb6a-500b-4cda-a3f9-23fa28de6428/mec53_preview2.jpg" ' + 
            '                          ,"ad/20/ad2097d0-a221-454d-bd09-bdf49ec5f84c/mec53-inspiring-presence-art.jpg" ' + 
            '                          ,"02/fc/02fcb349-3447-4104-a1a9-c0fa19b45c4e/art-lost-underground.jpg" ' + 
            '                          ,"21/64/216407ba-bfac-4ecc-b5b5-8988769788a5/art-searching-the-caves.jpg" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "TRAVEL" ' + 
            '              ,"voffset": 1397 ' + 
            '              ,"images": [ "bc/46/bc4690f5-b669-400b-bc4f-6e92cb813451/mec16_preview.jpg" ' + 
            '                          ,"c8/03/c80313c8-af07-43f8-af92-d6fb8cda51c2/kn22_preview.jpg" ' + 
            '                          ,"bd/d8/bdd85041-d2ec-4861-ba91-d4367cf73fa7/mec62_preview_5.png" ' + 
            '                          ,"74/dc/74dc5d7a-9d32-4b3d-860d-8fb51385c08d/mec44_unholycrypt.jpg" ' + 
            '                          ,"9d/a4/9da4b616-d227-4713-bf97-2ca11bb9a177/mec48_preview2.jpg" ' + 
            '                          ,"e4/a4/e4a447c9-d9a4-49dc-8d1f-7cd3c04e5535/mec48_preview.jpg" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "ENCOUNTER" ' + 
            '              ,"voffset": 1730 ' + 
            '              ,"images": [ "bc/0d/bc0dda1d-5722-4f61-abe0-60b868665aa2/umen43_growing-stench-art.jpg" ' + 
            '                          ,"cf/62/cf622e9b-9e77-40c2-98be-5a8c27a8f745/mec01_step_01.jpg" ' + 
            '                          ,"47/df/47df5db1-b712-489e-9dd3-67f71becbb73/mec01_step_02.jpg" ' + 
            '                          ,"3c/84/3c849cf3-e3b0-48ec-bd5f-312178c7974f/jme03-04_preview2.jpg" ' + 
            '                          ,"dc/ef/dcefcd54-6869-419b-9a42-8edd87dc47df/umen35-shadow-the-orcs-art.jpg" ' + 
            '                          ,"4f/e0/4fe0002f-3fd3-463b-8000-4b01ee45d992/mes01-05_preview1.png" ' + 
            '                          ,"00/6e/006e18e0-cd00-4083-9ce6-42ead3f90f05/jme01_preview_1.jpg" ' + 
            '                          ,"3e/c5/3ec56810-9135-4d9e-ad9b-63b041398aad/umen36_preview.png" ' + 
            '                          ,"5b/d5/5bd5866f-4bd7-4833-860e-21617f1814ba/furiouscharge.jpg" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "ENEMY ATTACK" ' + 
            '              ,"voffset": 2180 ' + 
            '              ,"images": [ "aa/40/aa40ab22-6d12-469e-9be4-89e57dc6a5ad/umec84-85_preview1.jpg" ' + 
            '                          ,"3a/42/3a42f3c8-58da-45f9-b081-39329b5a5aca/umen20-34_preview.png" ' + 
            '                          ,"10/3d/103d50a4-2789-4e99-91d0-5cb1e8e20f46/umen43_wicked-hobbits-art.jpg" ' + 
            '                          ,"b1/5d/b15d737a-8382-4e29-b746-9e65b3663fc9/mec54-city-besieged-art.jpg" ' + 
            '                          ,"54/2d/542d8e96-93dd-444f-b04c-2a4a1af0a8c1/mec101_announcement_preview.png" ' + 
            '                          ,"a3/8a/a38aa921-1934-43c4-a045-f36ed3979c76/mec45_preview5.jpg" ' + 
            '                          ,"93/e5/93e57b07-195a-45c9-8b51-1fcbd475939c/mec41_ruthlesshilltroll.jpg" ' + 
            '                          ,"3c/a1/3ca1aede-0f61-471a-b3b6-30c271b2c0a4/mec60_preview1.jpg" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "PLAYER ATTACK" ' + 
            '              ,"voffset": 3266 ' + 
            '              ,"images": [ "6b/ab/6baba999-f2ff-492f-abd1-ad9893f1556e/mec_fellowship_2017_art_battle.png" ' + 
            '                          ,"ed/cc/edcc9c29-9bfa-4e25-b6ae-8e339893005a/fellowship2015_preview1.jpg" ' + 
            '                          ,"4e/5a/4e5a5a48-7678-45d2-bce0-a5c10bab1546/mec_fellowship_2017_art_siege.png" ' + 
            '                          ,"58/b5/58b54268-64b1-441b-a007-e2686e9e89e6/jme01_preview_5.png" ' + 
            '                          ,"c5/c7/c5c7cb22-7a5c-41bd-8716-d773efe7301b/mec53_preview.jpg" ' + 
            '                          ,"17/57/17579155-a219-4eb5-a1bd-42072b43470e/mec59_preview4.jpg" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "REFRESH" ' + 
            '              ,"voffset": 4130 ' + 
            '              ,"images": [ "bd/7c/bd7cf918-9c0f-4010-aff9-417431615ce7/mec01_step_00.jpg" ' + 
            '                          ,"8f/66/8f66dc61-addd-4d8a-9a07-42f070536499/mec08_preview.jpg" ' + 
            '                          ,"28/53/28531b9e-a3f6-4c50-a1ec-39899ac073cb/mec17_preview.jpg" ' + 
            '                          ,"b4/3f/b43f119e-4850-44f5-b8c7-c21b1f2c1174/umen47_art_desecrated-pavilion.png" ' + 
            '                          ,"58/b5/58b54268-64b1-441b-a007-e2686e9e89e6/jme01_preview_5.png" ' + 
            '                         ] ' + 
            '             } ' + 
            '            ,{ "name": "END" ' + 
            '              ,"voffset": 4594 ' + 
            '              ,"images": [""] ' + 
            '             } ' + 
            '           ]' + 
            '}' 
        ); 
 
        const MAXPLAYERS = 6; 
 
        /* define state encoding values (see https://clivesyabb.com/2021/10/01/encoding-multiple-values-in-a-single-number/) */ 
        const ACTIVE_PLAYERS_EVS = { cram: 36534967, extract: 67 }; 
        const FIRST_PLAYER_EVS = { cram: 110428998, extract: 7 }; 
        const CURRENT_PLAYER_EVS = { cram: 119761026, extract: 71 }; 
        const ROUND_EVS = { cram: 121541350, extract: 53 }; 
        const STEPNUM_EVS = { cram: 127068984, extract: 73 }; 
 
        /* define webpage constants */ 
        const BACKGROUND_CONTAINER = document.getElementsByClassName('BackgroundContainer')[0]; 
        const SEQUENCE_AREA = document.getElementById('SequenceArea'); 
        const TAB_NEW = document.getElementById('newGame'); 
        const TAB_BACK = document.getElementById('back'); 
        const TAB_SKIP = document.getElementById('skip'); 
        const TAB_ELIM = document.getElementById('elim'); 
        const TAB_OUT_OF_SEQ_ENEMY_ATTACK = document.getElementById('oosEAttack'); 
        const TAB_OUT_OF_SEQ_PLAYER_ATTACK = document.getElementById('oosPAttack'); 
        const TAB_OPTIONS = document.getElementById('options'); 
        const TAB_ABOUT = document.getElementById('about'); 
        const TAB_LOADSAVE = document.getElementById('loadSave')
        const MODAL_DIALOGUE = document.getElementById('GameModal'); 
        const MODAL_BANNER = MODAL_DIALOGUE.getElementsByClassName('modalBanner')[0]; 
        const MODAL_CHANGE_BANNER = MODAL_DIALOGUE.getElementsByClassName('modalChangeBanner')[0]; 
        const MODAL_HEADER = MODAL_DIALOGUE.getElementsByTagName('h1')[0]; 
        const MODAL_DETAIL = MODAL_DIALOGUE.getElementsByTagName('p')[0]; 
        const MODAL_CLOSE = document.getElementById('modalClose'); 
        const MODAL_BUTTONS_AREA = MODAL_DIALOGUE.getElementsByClassName('modalButtonsArea')[0]; 
        const GAME_OUTLINE = document.getElementById('gameOutline'); 
        const HELP_AREA = document.getElementById('HelpArea'); 
        const HELP_AREA_HEADER = document.getElementById('helpAreaHeader'); 
        const HELP_AREA_TEXT = HELP_AREA_HEADER.getElementsByTagName('p')[0]; 
        const HELP_AREA_DISPLAY = document.getElementById('helpAreaDisplay'); 
        const INFO_AREA = document.getElementById('InfoArea'); 
        const ABOUT_AREA = document.getElementById('AboutArea'); 
        const OPTIONS_AREA = document.getElementById('OptionsArea');
        const LOAD_AREA = document.getElementById('LoadSaveArea'); 
        const CODE_BOX = document.getElementById('codeBox');
        const CODE_ERR = document.getElementById('codeErr');
        const NAMES_AREA = document.getElementById('NamesArea');
        const NAMES_FORM = document.getElementById('playernames');
        const IS_MOBILE = navigator.userAgentData.mobile; 
 
        /* Define webpage globals */ 
        var SequenceImage; 
        var SequenceImageSize; 
        var ImageObserver; 
        var OutlineBox; 
        var StateStorageKey = 'LOTR_States'; 
        var StateHistory; 
        var SettingsStorageKey = 'LOTR_Settings';
        var Settings = 
            {
                preferCompendium: true,
                campaign: false,
                previouslyExtended: [],
                altSetup: false,
                names: [], 
            }
        var OptionsStorageKey = 'LOTR_Options'; 
        var Options =  
            { 
                compendiumFormat: 'HTML', 
                showGeneralTips: true, 
                showTabTips: true, 
                showChangePhaseSteps: true, 
                altSetup: false,
            }; 
        var RegexMultiplayerMatch = new RegExp("\\{([^\}\|]*)\\|([^\}\|]*)\\}"); 
        var RegexSamePlayerMatch = new RegExp("\\{([^\}\|]*)\\=([^\}\|]*)\\}"); 

        // Ensure certain page elements are not visible on start up. 
        MODAL_BANNER.classList.add('hidden'); 
        MODAL_CHANGE_BANNER.classList.add('hidden'); 
        MODAL_CHANGE_BANNER.innerHTML = ''; 
        NAMES_AREA.classList.add('hidden');
        HELP_AREA.classList.add('hidden'); 
        GAME_OUTLINE.classList.add('hidden'); 
        ABOUT_AREA.classList.add('hidden'); 
        OPTIONS_AREA.classList.add('hidden'); 
        LOAD_AREA.classList.add('hidden');  
        
        // Set up logging
        if (VERSION.endsWith('x')) {
            ind=0;
            function log(message) { console.log(message); }
            function logenter(message) { console.log(' '.repeat(ind++)+'>'+message); }
            function logleave(p1, p2=null) { console.log(' '.repeat(--ind)+'<'+(p2 ?? p1)); return p1; } 
        } else { 
            function log(message) {}
            function logenter(meesage) {}
            function logleave(p1, p2) { return p1; }
        }
    </script> 
    <script> /* main code */ 
        logenter('main'); 
        INFO_AREA.innerHTML = VERSION; 
        gui_loadBackground('./Images/RoundSequence.png'); 
 
        function newgame_setup(token, nmbr) { // Open modal dialogue to get information about (or to cancel) a new game 
            logenter('newgame_setup('+token+','+nmbr+')'); 
            NAMES_AREA.innerHTML="";
            Settings.campaign = (token == 'c'); 
            var prompt = '';
            var closeTip = '(press to return without starting a new game)'; 
            var buttons = []; 
            switch (token) { 
                case 'a': // a = ask for type of game
                    prompt = 'Is this new game part of a campaign?' 
                    buttons = [gui_generateButton('Regular', 'newgame_setup("r")'), 
                               gui_generateButton('Campaign', 'newgame_setup("c")') 
                              ]; 
                    break; 
                case 'c': // c = campaign game
                case 'r': // r = regular game
                    var prompt = 'How many players in the ' + (Settings.campaign ? 'campaign' : 'new game') + '?'; 
                    for (var x = 1; x <= MAXPLAYERS; x++) { 
                        buttons[x - 1] = gui_generateButton('&nbsp;' + x + '&nbsp;', 'newgame_setup("n",' + x + ')'); 
                    } 
                    break; 
                case 'n': // n = ask for names
                    if (nmbr == 1) {
                        Settings.names = [ '', 'The player'];
                        newgame_start(1);
                        return; // do not continue - the modal should not be shown again.
                    }
                    prompt = "Enter the players' names";
                    game_setNames(nmbr);
                    buttons = [gui_generateButton('Done', 'NAMES_AREA.classList.add("hidden");newgame_start(' + nmbr + ')')]; 
                    closeTip = false;
                    break;
            } 
 
            gui_showModal('', '', closeTip, prompt, '', buttons); 
            logleave('newgame_setup'); 
        } 

        function game_setNames(numPlayers) {
            logenter('game_setNames(' + numPlayers + ')'); 
            var prevNames = Settings.names;
            for(let pn = 1; pn <= numPlayers; pn++) {
                Settings.names[pn] = (pn < prevNames.length) ? prevNames[pn] : 'Player ' + pn;
            }
            NAMES_AREA.innerHTML = '';
            for(let pn = 1; pn <= numPlayers; pn++) { 
                NAMES_AREA.innerHTML += 
                        '<div class="nameInp">' +
                            '<label>Player ' + pn + ': </label>' +
                            '<input type="text" id="nameInp' + pn +'" onchange="game_changeName('+pn+',this.value)" value="' + Settings.names[pn] +'"></input>' +
                        '</div>' +
                        ((pn < numPlayers) 
                            ? '<span class="tooltipContainer">' +
                                '<button type="button" class="nameSwap" onclick="game_swapNames('+pn+')">&#8645;' + '&nbsp;'.repeat(10) + '&#8645;</button>' +
                                (Options.showGeneralTips ? '<span class="tooltiptext">Switch Player ' + pn + ' with Player ' + (pn + 1) + '</span>' : '') + 
                              '</span>' 
                            : '');
                }            
            NAMES_AREA.classList.remove("hidden");
            logleave('game_setNames'); 
        }
            
        function game_changeName(player, name) {
            Settings.names[player] = name;
        }

        function game_swapNames(playerNum){
            var aElement = document.getElementById('nameInp' + playerNum);
            var bElement = document.getElementById('nameInp' + (playerNum + 1));
            var aName = (Settings.names[playerNum + 1] == 'Player ' + (playerNum + 1))
                ? 'Player ' + playerNum
                : Settings.names[playerNum + 1];
            var bName = (Settings.names[playerNum] == 'Player ' + playerNum)
                ? 'Player ' + (playerNum + 1)
                : Settings.names[playerNum];
            aElement.value = aName;
            Settings.names[playerNum] = aName;
            bElement.value = bName;
            Settings.names[playerNum + 1] = bName;
        }

        function newgame_start(numPlayers) { // Resets the page for a new game 
            logenter('newgame_start('+numPlayers+')');
            NAMES_AREA.innerHTML="";
            var newStateHash = (Math.pow(2, numPlayers + 1) - 1) * ACTIVE_PLAYERS_EVS.cram + 
                               1 * FIRST_PLAYER_EVS.cram + 
                               1 * CURRENT_PLAYER_EVS.cram + 
                               0 * ROUND_EVS.cram + 
                               0 * STEPNUM_EVS.cram; 
            StateHistory = [newStateHash]; 
            localStorage.setItem(StateStorageKey, StateHistory.toString()); 
            Settings.altSetup = Options.altSetup;
            Settings.previouslyExtended = []; 
            localStorage.setItem(SettingsStorageKey, JSON.stringify(Settings)); 
            gui_recordOptions(); 
            
            gui_initializeSteps(); 
 
            var start = 
                {  
                    stepNum: 0, 
                    player: 1, 
                    round: 0, 
                    first: 1, 
                    active: '1'.repeat(numPlayers + 1) 
                }; 
            start = game_autoAdvanceStep(start) 
            game_advanceToStep(start.stepNum); 
            logleave('newgame_start'); 
        } 
 
        function game_advanceToStep(newStepNum, newPlayer=null, newFirst=null, newRound=null) { // shows the modal dialogue information for a step in the game 
            logenter('game_advanceToStep('+newStepNum+')'); 
            // At this point we have not yet changed our state to be in the new step. 
            // We are gathering information about the current state we are moving from and the new state we are move to. 
            var fromState = game_decodeStateHash(StateHistory[0]); 
 
            var toState = { 
                active  : fromState.active, 
                first   : newFirst ?? fromState.first, 
                player  : newPlayer ?? fromState.player, 
                round   : newRound ?? fromState.round, 
                stepNum : newStepNum, 
            }; 
 
            var newStateHash = 
                parseInt(toState.active, 2) * ACTIVE_PLAYERS_EVS.cram + 
                toState.first * FIRST_PLAYER_EVS.cram + 
                toState.player * CURRENT_PLAYER_EVS.cram + 
                toState.round * ROUND_EVS.cram + 
                toState.stepNum * STEPNUM_EVS.cram; 
                 
            game_setCurrentState(newStateHash); 
            logleave('game_advanceToStep'); 
        } 
 
        function game_autoAdvanceStep(initial) { 
            logenter('game_autoAdvanceStep');  
            var relevant = { 
                stepNum: initial.stepNum, 
                player: initial.player, 
                round: initial.round, 
                first: initial.first, 
            }; 

            while ((((Sequence.steps[relevant.stepNum].type ?? '').includes('campaign')) && !Settings.campaign) || // skip campaign steps when it is not a campaign game 
                    (((Sequence.steps[relevant.stepNum].type ?? '').includes('multi')) && (initial.active.length == 2)) || // skip multiplayer steps when there is only one player 
                    ((Sequence.steps[relevant.stepNum].phase == 'Change') && !Options.showChangePhaseSteps) // skip phase end/start steps when they are to be shown 
                  ) { 
                if (Sequence.steps[relevant.stepNum].gameloopstart != null) { 
                    relevant.stepNum = Sequence.steps[relevant.stepNum].gameloopstart; 
                    relevant.player = game_getNextPlayer(relevant.player, initial.active) 
                    relevant.round++; 
                    relevant.first = game_getNextPlayer(relevant.first, initial.active); 
                } else { 
                    relevant.stepNum++; 
                } 
            } 
            
            return logleave(relevant, 'game_getNextPlayer'); 
        } 
 
        function game_backToPreviousStep() { 
            logenter('game_backToPreviousStep'); 
            var toStateHash = StateHistory[1]; // the previous state is index 1 because we have already added the current state to the history. 
            StateHistory.splice(0, 2); // remove the current and previous state from the history. 
            localStorage.setItem(StateStorageKey, StateHistory.toString()); 
            game_setCurrentState(toStateHash); 
            logleave('game_backToPreviousStep'); 
        } 
 
        function game_decodeStateHash(stateHash) { 
            logenter('game_decodeStateHash'); 
            var players = modulo(stateHash, ACTIVE_PLAYERS_EVS.extract).toString(2); 
            var stepNum = modulo(parseInt(stateHash, 10), STEPNUM_EVS.extract); 
            var decoded = { 
                active     : players, 
                first      : modulo(stateHash, FIRST_PLAYER_EVS.extract), 
                player     : modulo(stateHash, CURRENT_PLAYER_EVS.extract), 
                numPlayers : players.length - 1, 
                round      : modulo(stateHash, ROUND_EVS.extract), 
                stepNum    : stepNum, 
                step       : Sequence.steps[stepNum] 
            }; 
            return logleave(decoded, 'game_decodeStateHash'); 
        } 
 
        function game_eliminatePlayer() { 
            logenter('game_eliminatePlayer'); 
            var current = game_decodeStateHash(StateHistory[0]); 
            var previous = game_decodeStateHash(StateHistory[1]); 
 
            var bannerInfo = game_setStandardBanners(current, previous); 
            var banner = bannerInfo[0]; 
            var changeBanner = bannerInfo[1]; 
            var showClose = bannerInfo[2]; 
            var header = bannerInfo[3]; 
 
            // text: 
            var detail = 'Select the player to eliminate'; 
 
            // buttons 
            var buttons = []; 
            var player = current.first; 
            do { 
                var next = game_getNextPlayer(player, current.active); 
                var newStateHash = 
                    (parseInt(current.active,2) - Math.pow(2, current.numPlayers-player)) * ACTIVE_PLAYERS_EVS.cram + 
                    ((player == current.first) ? next : current.first) * FIRST_PLAYER_EVS.cram + 
                    ((player == current.player) ? next : current.player) * CURRENT_PLAYER_EVS.cram + 
                    current.round * ROUND_EVS.cram + 
                    current.stepNum * STEPNUM_EVS.cram;  
                buttons.push(gui_generateButton(Settings.names[player], 'game_setCurrentState(' + newStateHash + ')')); 
                player = next; 
            } 
            while (player != current.first); 
            buttons.push(gui_generateButton('Cancel', 'game_setCurrentState(' + StateHistory[0] + ',"true")')); 
 
            // SideTab: back 
            var showBack = false; 
 
            // SideTab: skip 
            var skipInfo = null; 
 
            // SideTab: eliminate player 
            var showElim = false; 
 
            // SideTab: victory points 
            var showVP = false; 
 
            // SideTab: out of sequence combat 
            var showOOSEA = false; 
 
            var SideTabInfo = [showBack, skipInfo, showElim, showVP, showOOSEA]; 
 
            // repositioning of the background image 
            var box = null; 
 
            gui_showModal(banner, changeBanner, showClose, header, detail, buttons, SideTabInfo, box); 
            logleave('game_eliminatePlayer'); 
        } 
 
        function game_expandText(text, current, previous=null) 
        { 
            logenter('game_expandText'); 
            if (text.includes('{')) { 
                // convert {pn} to the current player's name 
                text = text.replace('{pn}', Settings.names[current.player]); 
 
                // convert {pn+} to the next player's name 
                text = text.replace('{pn+}', Settings.names[game_getNextPlayer(current.player, current.active)]); 
 
                // convert {pp} to the current player's 'prefix' (used in displaying stage names) 
                text = text.replace('{pp}', (current.numPlayers == 1) ? "" : Settings.names[current.player] + ": "); 
                 
                // convert {a|b} to "a" if there is only one player, and "b" if there are more than one 
                text = (text.replace(RegexMultiplayerMatch, ((current.active.match(/1/g) || []).length == 2) ? "$1" : "$2")); 
 
                // convert {a=b} to "a" if the player is the same as the last step's, and "b" if it is a different player.
                var same = (previous == null) || 
                           ((current.player == previous.player) && (current.stepNum < previous.stepNum)) 
                text = (text.replace(RegexSamePlayerMatch, same ? "$2" : "$1")); 

                // kludge fix for single-player references at start and mid-phrase.
                text = text.replace(' The ', ' the ');
            } 
 
            return logleave(text, 'game_expandText'); 
        } 
 
        function game_findStepNum(searchName) { 
            logenter('game_findStepNum('+searchName+')'); 
            var step = null; 
            var found = false; 
            for (step = 0; step < Sequence.steps.length; step++) { 
                found = (Sequence.steps[step].name.startsWith(searchName));
                if (found) { 
                    break 
                }; 
            }; 
            return logleave(step, 'game_findStepNum'); 
        } 
 
        function game_getNextPlayer(player, active, dir=1) { 
            logenter('game_getNextPlayer('+player+',"'+active+'",'+dir+')'); 
            var next_player = player; 
            var num_players = active.length - 1; 
            do { 
                next_player = modulo(next_player - 1 + dir, num_players) + 1;                 
            } 
            while (active[next_player] == '0'); 
 
            return logleave(next_player, 'game_getNextPlayer = '+next_player); 
        } 
 
        function game_hideHelp() { 
            logenter('game_hideHelp'); 
            HelpArea.classList.add("hidden");
            gui_showSideTab('all'); // the help display hides the side tabs 
            logleave('game_hideHelp'); 
        } 
 
        function game_setCurrentState(currentStateHash, isRefresh = false) { 
            logenter('game_setCurrentState'); 
            var previous = game_decodeStateHash(StateHistory[0]); 
            var current = game_decodeStateHash(currentStateHash); 
            if (isRefresh) {
                // If refresh is used on a step that should be skipped then advance to next step.
                // This can occur when Options have been changed.
                var advanced = game_autoAdvanceStep(current);
                if (advanced.stepNum != current.stepNum) {
                    game_advanceToStep(advanced.stepNum);                   
                    return; // do not continue - game_advanceToStep() has made its own call to game_setCurrentState() to show the new step.
                }
            } else { 
                // insert the new state and save it. 
                StateHistory.unshift(currentStateHash); 
                localStorage.setItem(StateStorageKey, StateHistory.toString()); 
            } 
 
            // new round: activate the image observer to change the background images 
            if (current.round != previous.round) { 
                Array.from(BACKGROUND_CONTAINER.getElementsByClassName('fixed')).forEach(imageDiv => {                     
                    ImageObserver.observe(imageDiv); 
                }); 
            } 
 
            var bannerInfo = game_setStandardBanners(current, previous); 
            var banner = bannerInfo[0]; 
            var changeBanner = bannerInfo[1]; 
            var showClose = bannerInfo[2]; 
            var header = bannerInfo[3]; 
 
            var isFirstPlayer = (current.player == current.first); 
            var isLastPlayer = (current.player == game_getNextPlayer(current.first, current.active, -1)); 
 
            var next =  
                {  
                    stepNum: current.stepNum + 1, 
                    player: current.player, 
                    round: current.round, 
                    first: current.first, 
                    active: current.active 
                }; 
 
            switch (true) { 
                case (current.step.teamloopstart != null): 
                    next.stepNum = (isLastPlayer) ? next.stepNum : current.step.teamloopstart; 
                    next.player = game_getNextPlayer(current.player, current.active); 
                    break; 
                case (current.step.playerloopstart != null): 
                    next.stepNum = current.step.playerloopstart; 
                    break; 
                case (current.step.gameloopstart != null): 
                    next.stepNum = current.step.gameloopstart; 
                    nextPlayer = game_getnext.player(current); 
                    next.round = current.round + 1; 
                    next.first = game_getNextPlayer (current.first, current.active); 
                    break; 
                case (current.step.oosReturn != null):
                    next.stepNum = game_decodeStateHash(StateHistory[current.step.oosReturn]).stepNum;
                    break;
                case ((current.round == 0) && (Sequence.steps[next.stepNum].gameloopend != null)): 
                    next.player = current.first; 
                    next.round = 1; 
                    break; 
            } 
 
            next = game_autoAdvanceStep(next); 
             
            // stepName: Shows the current step. 
            var stepName = game_expandText(current.step.name, current);  
 
            var hasActionWindow = (current.step.actionwindow || stepName.includes('Action Window')); 
            var tipClass = (hasActionWindow && Options.showGeneralTips) ? ' class="tooltipContainer"' : ''; 
            var spanTag = (hasActionWindow) ? '<span style="color:SpringGreen"' + tipClass + '>' : ''; 
            var tipText = (stepName.startsWith('Special'))  
                ? 'May play Ally, Attachment and/or Event cards' 
                : 'May play Event cards only'; 
            var spanEndTag = (hasActionWindow && Options.showGeneralTips) ? '<span class="tooltiptext">' + tipText + '</span></span>' : '</span>'; 
            var detail = ''; 
            switch (true) { 
                case (stepName.includes('Action Window')): 
                    detail += spanTag + stepName + spanEndTag; 
                    break;  
                case (hasActionWindow): 
                    detail += stepName + '<br/>&amp;<br/>' + spanTag + 'Action Window<br/>' + spanEndTag; 
                    break; 
                default: 
                    detail += stepName; 
                    break; 
            } 
            detail = game_expandText(detail, current); 
 
            // buttons 
            var buttons = []; 
            if ((current.numPlayers > 1) && ((current.step.type ?? '').includes('1st'))) {
                for (pn = 1; pn <= current.numPlayers; pn++) {
                    buttons.push(gui_generateButton(Settings.names[pn], 'game_advanceToStep(' + next.stepNum + ',' + next.player + ',' + pn + ',' + next.round + ')')); 
                }
            } else {
                buttons.push(gui_generateButton('Next', 'game_advanceToStep(' + next.stepNum + ',' + next.player + ',' + next.first + ',' + next.round + ')')); 
            }
            if (current.step.help) { 
                buttons.push(gui_generateButton('Help', 'game_showHelp("' + stepName + '",' + JSON.stringify(current.step.help) + ')')); 
            } 
 
            // SideTab: back 
            var showBack = (current.stepNum > 1); 
 
            // SideTab: skip 
            var skipInfo = null; 
            switch (true) { 
                case ((current.step.teamskip != null) && (isFirstPlayer)): 
                    skipText = game_expandText(current.step.teamskip[0], current); 
                    skipInfo = [skipText, current.step.skipto, current.first]; 
                    break; 
                case (current.step.playerskip != null): 
                    var skipText = game_expandText(current.step.playerskip, current, previous) 
                    var skiptoStepNum = (isLastPlayer) ? current.step.playerloopend + 1 : current.stepNum; 
                    var skiptoPlayer = game_getNextPlayer(current.player, current.active); 
                    skipInfo = [skipText, skiptoStepNum, skiptoPlayer]; 
                    break; 
            } 
 
            // SideTab: eliminate player 
            var showElim = (((current.active.match(/1/g) || []).length > 2) && (current.step.phase != "Setup")); 
 
            // SideTab: out of sequence combat 
            var showOOS = (current.step.phase != "Setup") && (!current.step.phase.startsWith("Special")); 
             
            var SideTabInfo = [showBack, skipInfo, showElim, showOOS]; 
 
            // repositioning of the background image 
            switch (true) { 
                case (current.step.boxes == null): 
                    OutlineBox = null; 
                    break; 
                case (current.step.boxes.length == 4): 
                    OutlineBox = current.step.boxes; 
                    break; 
                case (isFirstPlayer): 
                    OutlineBox = current.step.boxes[0]; 
                    break; 
                case (isLastPlayer): 
                    OutlineBox = current.step.boxes[current.step.boxes.length - 1]; 
                    break; 
                default: 
                    OutlineBox = current.step.boxes[1]; 
                    break; 
            } 
 
            gui_showModal(banner, changeBanner, showClose, header, detail, buttons, SideTabInfo); 
            logleave('game_setCurrentState'); 
        } 
 
        function game_setStandardBanners(currentState, previousState) { 
            logenter('game_setStandardBanners'); 
            // banner: shows the current round and first player
            var banner = (currentState.round == 0) 
                ? '' 
                : 'Round ' + currentState.round + '{| : (' + Settings.names[currentState.first] + ' is 1st player)}'; 
 
            // change banner: shows when the phase changes (unless phase changes are shown as steps) 
            var isPhaseChange = (currentState.step.phase != previousState.step.phase) &&  
                                (!currentState.step.phase.startsWith('Special')) && 
                                (!previousState.step.phase.startsWith('Special')); 
            var changeBanner = (isPhaseChange && !Options.showChangePhaseSteps) 
                ? 'End of the ' + previousState.step.phase + ' Phase<br>' + 'Start of the ' + currentState.step.phase + ' Phase' 
                : ''; 
 
            // close button: shows only for the new game state 
            var showClose = false; 
 
            // header: shows the current phase and stage 
            var header =  
                ((currentState.step.phase == 'Change') ? '' : currentState.step.phase + ' Phase') + 
                ((currentState.step.stage == null) ? '' : ': ' + currentState.step.stage + ' Stage'); 
 
            var banners = [game_expandText(banner, currentState, previousState), 
                    changeBanner,  
                    showClose,  
                    header 
                   ]; 
            return logleave(banners, 'game_setStandardBanners'); 
        } 
 
        function game_showCompanion(pageNum, event = null) { 
            logenter('game_showCompanion'); 
            var address = 'https://lotr-lcg-quest-companion.gamersdungeon.net/#Rule'; 
 
            HELP_AREA_DISPLAY.innerHTML = "<iframe src='" + address + pageNum + "' type='text/html'></iframe>"; 
            HELP_AREA.classList.remove('hidden'); 
 
            if (event?.altKey) { 
                window.open(address + pageNum, 'Quest Companion'); 
            } 

            if (Settings.preferCompendium) {
                Settings.preferCompendium = false;
                localStorage.setItem(SettingsStorageKey, JSON.stringify(Settings)); 
            }

            logleave('game_showCompanion'); 
        } 
 
        function game_showCompendium(helpInfo, event=null, changePref=true) { 
            logenter('game_showCompendium'); 
            var address, fragment, query; 
            switch(Options.compendiumFormat) { 
                case 'HTML': 
                    address = './RulesCompendium_v2.0/Rules_Compendium_v2_0.html'; 
                    fragment = '#p' + helpInfo[0].toString().padStart(3, '0') + '_' + helpInfo[3]; 
                    query = '?section=s' + helpInfo[0].toString().padStart(3, '0') + '_' + helpInfo[4] + 
                            '&cwidth=' + HELP_AREA_DISPLAY.offsetWidth; 
                    break; 
                case 'PDF': 
                    address = './Images/RulesCompendium_v2.0.pdf'; 
                    fragment = '#page=' + helpInfo[0] + '&zoom=100,' + helpInfo[1] + ',' + helpInfo[2] + '&pagemode=none&view=FitH'; 
                    query = ''; 
                    break; 
            } 
            HELP_AREA_DISPLAY.innerHTML = "<iframe src='" + address + query + fragment + "' ></iframe>"; 
            HELP_AREA.classList.remove('hidden'); 
 
            if (event?.altKey) { 
                window.open(address + query + fragment, 'Rules Compendium'); 
            }  

            if (changePref && (!Settings.preferCompendium)) {
                Settings.preferCompendium = true;
                localStorage.setItem(SettingsStorageKey, JSON.stringify(Settings)); 
            }

            logleave('game_showCompendium'); 
        } 
 
        function game_showHelp(stepText, helpLocations) { 
            logenter('game_showHelp'); 
            var compendiumInfo = helpLocations[0]; 
            var companionInfo = (helpLocations.length < 2) ? [] : helpLocations[1]; 
            var actionWindowInfo = (helpLocations.length < 3) ? [] : helpLocations[2]; 
            var tipText = (Options.showGeneralTips && !IS_MOBILE) ? 'Hold Alt while pressing the button to open help in a new tab' : ''; 
            HELP_AREA_TEXT.innerHTML = 
                stepText + 
                '<div class="centredHolder">' + 
                ((compendiumInfo.length == 0) ? '' : gui_generateButton('Compendium<br/>', 'game_showCompendium(' + JSON.stringify(compendiumInfo) + ',event)', 'helpBtn', tipText)) + 
                ((companionInfo.length == 0) ? '' : gui_generateButton('Companion<br/>', 'game_showCompanion(' + companionInfo[0] + ',event)', 'helpBtn', tipText)) + 
                ((actionWindowInfo.length == 0) ? '' : gui_generateButton('Action Window<br/>', 'game_showCompendium(' + JSON.stringify(actionWindowInfo) + ',event,false)', 'helpBtn', tipText)) + 
                '</div>'; 
 
            gui_hideSideTab('all'); 
            if ((compendiumInfo.length == 0) && (companionInfo.length == 0)) { 
                game_showCompendium(actionWindowInfo); 
            } 
            else if (Settings.preferCompendium && (compendiumInfo.length > 0)) { 
                game_showCompendium(compendiumInfo); 
            } else { 
                game_showCompanion(companionInfo[0]); 
            } 
            logleave('game_showHelp'); 
        } 
 
        function game_startOutOfSeqAttack(attacker) { 
            logenter('game_startOutOfSeqAttack'); 
            var current = game_decodeStateHash(StateHistory[0]); 
            var oosStart = game_findStepNum((attacker == 'enemy') ? 'Deal Shadow Card' : 'Declare Attacked Enemy and Attackers'); 
            game_advanceToStep(oosStart); 
            logleave('game_startOutOfSeqAttack'); 
        } 
 
        function gui_clearAndReload() { 
            logenter('gui_clearAndReload');
            if (VERSION.includes('x')) { 
                localStorage.removeItem(StateStorageKey); 
                localStorage.removeItem(SettingsStorageKey);
                location.reload(); 
            }
            logleave('gui_clearAndReload');
        } 
 
        function gui_loadBackground(url) { 
            logenter('gui_loadBackground'); 
            // Read any recorded history, options, and settings and display the game state. 
            var read = localStorage.getItem(SettingsStorageKey);   
            if (read) { 
                Settings = JSON.parse(read); 
            } 
            read = localStorage.getItem(OptionsStorageKey);   
            if (read) { 
                Options = JSON.parse(read); 
            } 
            StateHistory = localStorage.getItem(StateStorageKey)?.split(','); 
 
            // Obtains the image of the sequence of steps and waits for the image to load before 
            // continuing the intialization. 
            const img = new Image(); 
            img.addEventListener('load', function () { 
                SequenceImageSize = [this.naturalHeight, this.naturalWidth]; 
                // once the sequence image is loaded then the rest of the page initialization can occur. 
                SEQUENCE_AREA.appendChild(img); 
                SequenceImage = SEQUENCE_AREA.getElementsByTagName('img')[0]; 
                gui_initialize(); 
 
                if (StateHistory) { 
                    game_setCurrentState(StateHistory[0], true); 
                } 
            }); 
            img.src = url; 
            logleave('gui_loadBackground'); 
        } 

        function gui_showLoadSave() {
            logenter('gui_showLoadSave');
            var b36 = '';
            if (StateHistory) {
                StateHistory.forEach(sh => b36 += parseInt(sh).toString(36) + ':');
                b36.slice(0, -1);
            }
            CODE_ERR.innerHTML = '';
            CODE_BOX.value = btoa(b36 + '|' + ((Settings) ? JSON.stringify(Settings) : ''));

            if (LOAD_AREA.classList.contains('hidden')) { 
                LOAD_AREA.classList.add('fade-in-fast'); 
                LOAD_AREA.classList.remove('hidden'); 
                LOAD_AREA.addEventListener('animationend', loadFadeinDone); 
            } 
 
            function loadFadeinDone() { 
                LOAD_AREA.classList.remove('fade-in-fast'); 
                LOAD_AREA.removeEventListener('animationend', loadFadeinDone); 
                window.addEventListener('click', loadUserClicked); 
                CODE_BOX.focus();
                CODE_BOX.select();
            } 

            function loadUserClicked(e) { 
                if (!LOAD_AREA.contains(e.target)) { 
                    if (CODE_BOX.value.trim() != '') {
                        try {
                            var saved = atob(CODE_BOX.value.trim()).split('|');
                            if (saved[0] == '') {
                                StateHistory = null;
                             } else {
                                 StateHistory = [];
                                 saved[0].split(':').forEach(sh => StateHistory.push(parseInt(sh, 36)));
                             }
                             Settings = JSON.parse(saved[1]);
                        }
                        catch(err) {
                            CODE_ERR.innerHTML = 'Unable to use the code entered:<br>[' + err.message +
                                                 ']<br>Please try again or clear the code and click outside this area';
                            return;
                        }
                        if (StateHistory) {
                            gui_initializeSteps();
                            game_setCurrentState(StateHistory[0], true);
                        } else {
                            gui_initializeSideTabs(StateHistory == null);
                        }
                    }
                    window.removeEventListener('click', loadUserClicked); 
                    LOAD_AREA.classList.add('fade-out-fast'); 
                    LOAD_AREA.addEventListener('animationend', loadFadeoutDone); 
                } 
            } 

            function loadFadeoutDone() { 
                LOAD_AREA.classList.add('hidden'); 
                LOAD_AREA.classList.remove('fade-out-fast'); 
                LOAD_AREA.removeEventListener('animationend', loadFadeoutDone); 
            } 

            logleave('gui_showLoadSave'); 
        } 

        function gui_adjustBackground() { 
            logenter('gui_adjustBackground'); 
            var pageTop = window.pageYOffset; 
            var pageBottom = pageTop + window.innerHeight; 
 
            // size the background images so that, when scrolling down, each image appears behind the corresponding area of the sequence. 
            var bounds = SequenceImage.getBoundingClientRect(); 
            var vscale = bounds.height / SequenceImageSize[0]; // vscale: 1px of the sequence image is being rendered as ?px high onscreen 
            var offset = SEQUENCE_AREA.offsetTop 
            var images = BACKGROUND_CONTAINER.getElementsByClassName('fixed'); 
            for (var index = 0; index < images.length; index++) { 
                var imageTop = Sequence.areas[index].voffset; 
                var imageBottom = Sequence.areas[index + 1].voffset; 
                images[index].style.height = offset + (imageBottom - imageTop) * vscale + 'px'; 
                images[index].style.backgroundSize = "cover"; 
                offset = 0; 
 
                // if the image area is currently onscreen then set its url now rather than waiting for  
                // ImageObserver (ImageObserver won't set the image until it detectes an intersection with the  
                // screen edges). 
                if ((imageTop <= pageBottom) && (imageBottom >= pageTop)) { 
                    gui_setBackgroundImageUrl(images[index]); 
                } 
            } 
            logleave('gui_adjustBackground'); 
        } 
 
        function gui_setBackgroundImages() { 
            logenter('gui_setBackgroundImages'); 
            for (var index = 0; index < Sequence.areas.length - 1; index++) { 
                var imageDiv = document.createElement('div'); 
                imageDiv.classList.add('fixed'); 
                imageDiv.setAttribute('id', 'bg_' + index); 
                BACKGROUND_CONTAINER.appendChild(imageDiv);  
                ImageObserver.observe(imageDiv); 
            } 
            logleave('gui_setBackgroundImages'); 
        } 
 
        function gui_setBackgroundImageUrl(imageContainer) { 
            logenter('gui_setBackgroundImageUrl'); 
            var round = (StateHistory) ? modulo(StateHistory[0], ROUND_EVS.extract) : 0; 
            offset = (round == 0) ? 1 : round * round; 
            imageIndex = imageContainer.id.split('_')[1] 
            var selectionNum = modulo(Math.floor(Date.now() / 86400000) + offset, Sequence.areas[imageIndex].images.length); 
            var selection = Sequence.areas[imageIndex].images[selectionNum]; 
            if (!imageContainer.style.backgroundImage.includes(selection)) { 
                imageContainer.style.backgroundImage = "url('https://images-cdn.fantasyflightgames.com/filer_public/" + selection + "')"; 
            } 
            logleave('gui_setBackgroundImageUrl'); 
        } 
 
        function gui_initialize() { 
            logenter('gui_initialize'); 
            // The ImageObserver waits for background image areas to come into view before 
            // determining which image to load. 
            ImageObserver = new IntersectionObserver(function(entries) { 
                entries.forEach(entry => { 
                    if (entry.isIntersecting === true) { 
                        gui_setBackgroundImageUrl(entry['target']); 
                        ImageObserver.unobserve(entry['target']); 
                    } 
                }) 
            }, { threshold: [0] }); 
            gui_setBackgroundImages(); 
             
            // Ensure that whenever the window is resized, the background image positions are redetermined. 
            window.onresize = gui_adjustBackground; 
            window.addEventListener('resize', gui_adjustBackground); 
            window.addEventListener('resize', gui_showOutline); 
            gui_adjustBackground(); 
 
            // Allow bacground images to be viewed without obstructions whenever 
            // the user hovers over the version number at the bottom of the page. 
            INFO_AREA.addEventListener('mouseenter', gui_hideForeground); 
            INFO_AREA.addEventListener('mouseleave', gui_showForeground); 
 
            gui_initializeSideTabs(StateHistory == null);
            gui_initializeSteps();             
            logleave('gui_initialize'); 
        } 

        function gui_initializeSideTabs(extend) {
            logenter('gui_initializeSideTabs');     
            gui_showSideTab(TAB_NEW, 'New Game', function () { newgame_setup('a'); }, null, extend);
            gui_showSideTab(TAB_OPTIONS, 'Options', function () { gui_showOptions(); }, 'Configure game and page settings', extend);
            gui_showSideTab(TAB_ABOUT, 'About', function () { gui_showAbout(); }, 'Show creators, rights, and version', extend);
            gui_showSideTab(TAB_LOADSAVE, 'Load/Save', function () { gui_showLoadSave(); }, null, extend);
            logleave('gui_initializeSideTabs'); 
        }
 
        function gui_initializeSteps() {
            logenter('gui_initializeSteps');     
            Sequence.steps =  
                ((Settings.altSetup) ? Sequence.altSetup : Sequence.origSetup).concat(Sequence.mainSeq) 
                .concat(Sequence.oosEAttack)
                .concat(Sequence.oosPAttack); 
 
            // translate the step names that define loops into step numbers 
            for (var step = 0; step < Sequence.steps.length; step++) { 
                if (Sequence.steps[step].gameloop) { 
                    var gameloopend = game_findStepNum(Sequence.steps[step].gameloop); 
                    Sequence.steps[step].gameloopend = gameloopend; 
                    Sequence.steps[gameloopend].gameloopstart = step; 
                } 
                if (Sequence.steps[step].teamloop) { 
                    var teamloopend = game_findStepNum(Sequence.steps[step].teamloop); 
                    Sequence.steps[step].teamloopend = teamloopend; 
                    Sequence.steps[teamloopend].teamloopstart = step; 
                } 
                if (Sequence.steps[step].playerloop) { 
                    var playerloopend = game_findStepNum(Sequence.steps[step].playerloop); 
                    Sequence.steps[step].playerloopend = playerloopend; 
                    Sequence.steps[playerloopend].playerloopstart = step; 
                } 
                if (Sequence.steps[step].teamskip) { 
                    Sequence.steps[step].skipto = game_findStepNum(Sequence.steps[step].teamskip[1]); 
                } 
            } 
            logleave('gui_initializeSteps'); 
        } 
 
        function gui_showModal(bannerText, changeBannerText, closeInfo, headerText, detailText, buttons, SideTabInfo) { // display the modal dialogue 
            logenter('gui_showModal('+bannerText+')'); 
            // banner: 
            MODAL_BANNER.innerHTML = bannerText; 
            if (bannerText == '') { 
                MODAL_BANNER.classList.add('hidden'); 
            } else { 
                MODAL_BANNER.classList.remove('hidden'); 
            } 
 
            // change banner: 
            if (MODAL_CHANGE_BANNER.innerHTML != changeBannerText) { 
                MODAL_CHANGE_BANNER.classList.remove('fade-in', 'fade-out'); 
                if (changeBannerText == '') { 
                    MODAL_CHANGE_BANNER.classList.add('fade-out'); 
                    MODAL_CHANGE_BANNER.addEventListener('animationend', clearModalChangeBanner); 
                } else { 
                    MODAL_CHANGE_BANNER.classList.add('hidden'); 
                    MODAL_CHANGE_BANNER.innerHTML = changeBannerText; 
                    MODAL_CHANGE_BANNER.classList.add('fade-in'); 
                    MODAL_CHANGE_BANNER.classList.remove('hidden'); 
                } 
            } 
            function clearModalChangeBanner() { 
                MODAL_CHANGE_BANNER.classList.add('hidden'); 
                MODAL_CHANGE_BANNER.innerHTML = ''; 
                MODAL_CHANGE_BANNER.removeEventListener('animationend', clearModalChangeBanner); 
            } 
 
            // close button: 
            var showClose = (typeof (closeInfo) == 'boolean') ? closeInfo : (showClose != ''); 
            var closeTip = (Options.showGeneralTips && (typeof (closeInfo) == 'string')) ? closeInfo : ''; 
            if (showClose) { // make the close <span> appear 
                MODAL_CLOSE.innerHTML = '&times;' + ((closeTip == '') ? '' : '<span class="tooltiptext">' + closeTip + '</span>'); 
                MODAL_CLOSE.style.display = 'block'; 
                MODAL_CLOSE.onclick = function () { // When the user clicks on <span> (x), close the modal dialogue                     
                    MODAL_DIALOGUE.style.display = 'none'; // hide the modal dialogue 
                    if (localStorage.getItem(StateStorageKey)) { 
                        latestStateHash = parseInt(localStorage.getItem(StateStorageKey).split(',')[0], 10); 
                        game_setCurrentState(latestStateHash); 
                    } 
                } 
            } else { // hide the close <span> 
                MODAL_CLOSE.style.display = 'none'; 
            } 
 
            // header: 
            MODAL_HEADER.innerHTML = headerText; 
 
            // detail: 
            MODAL_DETAIL.innerHTML = detailText; 
 
            // buttons: 
            MODAL_BUTTONS_AREA.innerHTML = ''; 
            buttons.forEach(b => MODAL_BUTTONS_AREA.innerHTML += b); 
 
            // SideTabs: 
            var showBack = (SideTabInfo == null) ? false : SideTabInfo[0]; 
            var skipInfo = (SideTabInfo == null) ? null : SideTabInfo[1]; 
            var showElim = (SideTabInfo == null) ? false : SideTabInfo[2] 
            var showOOS = (SideTabInfo == null) ? false : SideTabInfo[3]; 
 
            // SideTabs: new game: 
            gui_showSideTab(TAB_NEW, 'New Game', function () { newgame_setup('a'); }); 
 
            // SideTabs: back: 
            if (showBack) { 
                gui_showSideTab(TAB_BACK, 'Back', function () { game_backToPreviousStep(); }, 'Go back 1 step'); 
            } else { 
                gui_hideSideTab(TAB_BACK); 
            } 
 
            // SideTabs: skip: 
            if (skipInfo == null) { 
                gui_hideSideTab(TAB_SKIP); 
            } else { 
                var skiptext = skipInfo[0].split('~')[0]; 
                var skiptip = (skipInfo[0] + '~').split('~')[1]; 
                var skipToStepNum = skipInfo[1]; 
                var skipToPlayer = skipInfo[2]; 
                gui_showSideTab(TAB_SKIP, skiptext, function () { game_advanceToStep(skipToStepNum, skipToPlayer); }, skiptip, true); 
            } 
 
            // SideTabs: eliminate player: 
            if (showElim) { 
                gui_showSideTab(TAB_ELIM, 'Elimination', function () { game_eliminatePlayer(); }, 'Select when a player is removed from the game'); 
            } else { 
                gui_hideSideTab(TAB_ELIM); 
            } 
 
            // SideTabs: Out of Sequence Attacks 
            if (showOOS) { 
                gui_showSideTab(TAB_OUT_OF_SEQ_ENEMY_ATTACK, 'Out of Sequence Enemy Attack', function () { game_startOutOfSeqAttack('enemy'); }, 'Enemy is attacking outside of the normal combat sequence'); 
                gui_showSideTab(TAB_OUT_OF_SEQ_PLAYER_ATTACK, 'Out of Sequence Player Attack', function () { game_startOutOfSeqAttack('player'); }, 'Character is attacking outside of the normal combat sequence'); 
            } else { 
                gui_hideSideTab(TAB_OUT_OF_SEQ_ENEMY_ATTACK); 
                gui_hideSideTab(TAB_OUT_OF_SEQ_PLAYER_ATTACK); 
            } 
 
            // SideTabs: Options 
            gui_showSideTab(TAB_OPTIONS, 'Options', function () { gui_showOptions(); }, 'Configure game and page settings'); 
 
            // SideTabs: About 
            gui_showSideTab(TAB_ABOUT, 'About', function () { gui_showAbout(); }, 'Show creators, rights, and version'); 
 
            // SideTabs: load/save: 
            gui_showSideTab(TAB_LOADSAVE, 'Load/Save', function () { gui_showLoadSave(); }); 
 
            MODAL_DIALOGUE.style.display = 'block';  // make the modal dialogue appear 
 
            // background image and outlining box: 
            // (this must be done AFTER the modal dialogue has been rendered) 
            gui_showOutline(); 
            logleave('gui_showModal'); 
        } 
 
        function gui_showOutline() { 
            logenter('gui_showOutline'); 
            if (OutlineBox == null) { 
                GAME_OUTLINE.classList.add('hidden'); 
            } else { 
                var bounds = SequenceImage.getBoundingClientRect(); 
                var vscale = bounds.height / SequenceImageSize[0]; // factor: 1px of the sequence image is being rendered as ?px high onscreen 
                var hscale = bounds.width / SequenceImageSize[1];  // factor: 1px of the sequence image is being rendered as ?px wide onscreen 
 
                var modalBottom = Math.ceil(MODAL_DIALOGUE.offsetTop + MODAL_DIALOGUE.offsetHeight); 
                var outlineOffset = Math.floor(Math.max(window.innerHeight / 20, 25)); // how many pixels from the bottom of the modal dialogue to where the current step will be shown. 
                var sequenceAreaTargetOffset = Math.max((modalBottom + outlineOffset) - SEQUENCE_AREA.offsetTop, 0); // how many pixels from the top of the sequence image display area to where we want to scroll the current step to. 
 
                // scroll the sequence image to show the current step under the modal dialogue 
                var sequenceImageOffsetTop = Math.max(OutlineBox[1] * vscale - sequenceAreaTargetOffset * vscale, 0); 
                window.scrollTo({ 
                    top: sequenceImageOffsetTop, 
                    left: 0, 
                    behavior: 'smooth' 
                }); 
 
                var boxTop = OutlineBox[1] * vscale; // as measured from the top of the sequence image on the current display 
                var boxHeight = (OutlineBox[3] - OutlineBox[1]) * vscale; 
                var boxWidth = (OutlineBox[2] - OutlineBox[0]) * hscale; 
 
                GAME_OUTLINE.style.top = boxTop + 'px'; 
                GAME_OUTLINE.style.height = boxHeight + 'px'; 
                GAME_OUTLINE.style.width = boxWidth + 'px'; 
                GAME_OUTLINE.classList.remove('hidden'); 
            } 
            logleave('gui_showOutline'); 
        } 
 
        function gui_showSideTab(tabElement, textContent, onclick, tipText = null, extend = false) { 
            logenter('gui_showSideTab'); 
            if (tabElement == 'all') { // Used when all tabs are hidden (e.g. when showing help) 
                document.getElementById('SideTabLeft').classList.remove('hidden'); 
                document.getElementById('SideTabRight').classList.remove('hidden'); 
                document.getElementById('SideTabBottom').classList.remove('hidden'); 
            } else { 
                tabElement.innerHTML = (tipText && Options.showTabTips) 
                    ? '<span class="tooltipContainer">' + textContent + '<span class="tooltiptext">' + tipText + '</span></span>' 
                    : '<span>' + textContent + '</span>'; 
                tabElement.parentElement.onclick = onclick; 
                tabElement.parentElement.classList.remove('hidden'); 
                var notBeenExtended = !Settings.previouslyExtended.includes(textContent); 
                if (extend || notBeenExtended) { 
                    tabElement.classList.add('simhover'); 
                    gui_retractSideTab(tabElement); 
                    if (notBeenExtended) { 
                        Settings.previouslyExtended.push(textContent); 
                        localStorage.setItem(SettingsStorageKey, JSON.stringify(Settings)); 
                    } 
                } 
            } 
            logleave('gui_showSideTab'); 
        } 
 
        function gui_hideSideTab(tabElement) { 
            logenter('gui_hideSideTab'); 
            if (tabElement == 'all') { 
                document.getElementById('SideTabLeft').classList.add('hidden'); 
                document.getElementById('SideTabRight').classList.add('hidden'); 
                document.getElementById('SideTabBottom').classList.add('hidden'); 
            } else { 
                if (tabElement.classList.contains('simhover')) { 
                   tabElement.classList.remove('simhover'); 
                } 
                tabElement.parentElement.classList.add('hidden'); 
                tabElement.innerHTML = ''; 
            } 
            logleave('gui_hideSideTab'); 
        } 
 
        async function gui_retractSideTab(SideTab) { 
            var i = ind;log(' '.repeat(i)+'>gui_retractSideTab'); 
            await sleep(5000); 
            SideTab.classList.remove('simhover'); 
            log(' '.repeat(i)+'<gui_retractSideTab'); 
        } 
 
        function gui_showAbout() { 
            logenter('gui_showAbout'); 
            if (ABOUT_AREA.classList.contains('hidden')) { 
                INFO_AREA.style.color = 'white'; 
                ABOUT_AREA.classList.add('fade-in'); 
                ABOUT_AREA.classList.remove('hidden'); 
                ABOUT_AREA.addEventListener('animationend', aboutFadeinDone); 
            } 
 
            function aboutFadeinDone() { 
                ABOUT_AREA.classList.remove('fade-in'); 
                ABOUT_AREA.removeEventListener('animationend', aboutFadeinDone); 
                window.addEventListener('click', aboutUserClicked); 
            } 
 
            function aboutUserClicked(e) { 
                window.removeEventListener('click', aboutUserClicked); 
                ABOUT_AREA.classList.add('fade-out'); 
                ABOUT_AREA.addEventListener('animationend', aboutFadeoutDone); 
            } 
 
            function aboutFadeoutDone() { 
                INFO_AREA.style.color = 'black'; 
                ABOUT_AREA.classList.add('hidden'); 
                ABOUT_AREA.classList.remove('fade-out'); 
                ABOUT_AREA.removeEventListener('animationend', aboutFadeoutDone); 
            } 
            logleave('gui_showAbout'); 
        } 
 
        function gui_showForeground() { 
            logenter('gui_showForeground'); 
            SEQUENCE_AREA.classList.remove('hidden'); 
            MODAL_DIALOGUE.classList.remove('hidden'); 
            gui_showSideTab('all'); 
            logleave('gui_showForeground'); 
        } 
 
        function gui_hideForeground() { 
            logenter('gui_hideForeground'); 
            SEQUENCE_AREA.classList.add('hidden'); 
            MODAL_DIALOGUE.classList.add('hidden'); 
            gui_hideSideTab('all'); 
            logleave('gui_hideForeground'); 
        } 
 
        function gui_showOptions() { 
            logenter('gui_showOptions'); 
            gui_setOptionsControls(); 
            if (OPTIONS_AREA.classList.contains('hidden')) { 
                OPTIONS_AREA.classList.add('fade-in'); 
                OPTIONS_AREA.classList.remove('hidden'); 
                OPTIONS_AREA.addEventListener('animationend', optionsFadeinDone); 
            } 
 
            function optionsFadeinDone() { 
                OPTIONS_AREA.classList.remove('fade-in'); 
                OPTIONS_AREA.removeEventListener('animationend', optionsFadeinDone); 
                window.addEventListener('click', optionsUserClicked); 
            } 
 
            function optionsUserClicked(e) { 
                if (!OPTIONS_AREA.contains(e.target)) { 
                    gui_recordOptions(true); 
                    window.removeEventListener('click', optionsUserClicked); 
                    OPTIONS_AREA.classList.add('fade-out'); 
                    OPTIONS_AREA.addEventListener('animationend', optionsFadeoutDone);
                    if (StateHistory) {
                        game_setCurrentState(StateHistory[0], true);
                    } else {
                        gui_initializeSideTabs(false);
                    }
                } 
            } 
 
            function optionsFadeoutDone() { 
                OPTIONS_AREA.classList.add('hidden'); 
                OPTIONS_AREA.classList.remove('fade-out'); 
                OPTIONS_AREA.removeEventListener('animationend', optionsFadeoutDone); 
            } 
            logleave('gui_showOptions'); 
        } 
 
        function gui_setOptionsControls() { 
            logenter('gui_setOptionsControls'); 
            document.options.compendiumAs[(Options.compendiumFormat == 'HTML') ? 0 : 1].checked = true; 
            document.options.showGenTips.checked = Options.showGeneralTips; 
            document.options.showTabTips.checked = Options.showTabTips; 
            document.options.altSetup.checked = Options.altSetup; 
            document.options.showChangePhaseSteps.checked = Options.showChangePhaseSteps; 
            logleave('gui_setOptionsControls'); 
        } 
 
        function gui_recordOptions(fromControls=false) { 
            logenter('gui_recordOptions('+fromControls+')'); 
            if (fromControls) { 
                Options.compendiumFormat = document.options.compendiumAs[0].checked ? 'HTML' : 'PDF'; 
                Options.showGeneralTips = document.options.showGenTips.checked; 
                Options.showTabTips = document.options.showTabTips.checked; 
                Options.altSetup = document.options.altSetup.checked; 
                Options.showChangePhaseSteps = document.options.showChangePhaseSteps.checked; 
            } 
            localStorage.setItem(OptionsStorageKey, JSON.stringify(Options)); 
            logleave('gui_recordOptions'); 
        } 
 
        function gui_generateButton(buttonText, onclick = null, btnClass = 'modalBtn', btnToolTip = '') { 
            logenter('gui_generateButton('+buttonText+')'); 
            var ocevent = (onclick == null) ? '' : " onclick='" + onclick + "'"; 
            var tt = ''; 
 
            if (Options.showGeneralTips && (btnToolTip != '')) { 
                btnClass += ' tooltipContainer'; 
                tt = '<span class="tooltiptext">' + btnToolTip + '</span>'; 
            } 
 
            var buttonhtml = "<button type='button' class='" + btnClass + "'" + ocevent + '>' + buttonText + tt + '</button>';
            return logleave(buttonhtml, 'gui_generateButton');  
        } 
 
        function modulo(dividend, divisor) { // because in javascript % is remainder not modulo 
            return ((dividend % divisor) + divisor) % divisor 
        } 
 
        async function sleep(ms) { 
            return await new Promise(resolve => setTimeout(resolve, ms)); 
        } 
    </script> 
</body> 
</html>